<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>aiOS 4.8 PRO Resizable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&family=JetBrains+Mono&display=swap');

        :root {
            --glass: rgba(10, 10, 20, 0.94);
            --glass-border: rgba(255, 255, 255, 0.1);
            --accent: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
        }

        body, html {
            margin: 0; padding: 0;
            font-family: 'Inter', sans-serif;
            height: 100vh; width: 100vw;
            overflow: hidden; background: #010103; color: white;
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(139, 92, 246, 0.15) 0%, transparent 45%),
                radial-gradient(circle at 85% 75%, rgba(16, 185, 129, 0.1) 0%, transparent 45%);
        }

        .brand { font-family: 'Orbitron', sans-serif; letter-spacing: 2px; }

        #desktop {
            position: relative; width: 100vw; height: 100vh;
            padding: 40px 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, 110px);
            grid-template-rows: repeat(auto-fill, 120px);
            grid-auto-flow: column;
            gap: 15px;
            z-index: 10;
        }

        .shortcut {
            display: flex; flex-direction: column; align-items: center; gap: 8px;
            cursor: pointer; transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 12px 5px; border-radius: 12px; border: 1px solid transparent;
            user-select: none; position: relative;
        }
        .shortcut:hover { background: rgba(255,255,255,0.07); border-color: var(--glass-border); transform: translateY(-3px); }
        
        .shortcut-icon {
            width: 58px; height: 58px; display: flex; align-items: center; justify-content: center;
            font-size: 28px; border-radius: 16px; background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px); border: 1px solid var(--glass-border);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        .shortcut-icon img { width: 100%; height: 100%; object-fit: cover; }
        .shortcut-label { font-size: 11px; font-weight: 500; text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.9); }

        .window {
            position: absolute; background: var(--glass); backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border); border-radius: 16px;
            display: none; flex-direction: column; z-index: 100;
            box-shadow: 0 30px 60px -12px rgba(0,0,0,0.8);
            min-width: 300px; min-height: 200px;
            overflow: visible; /* –î–æ–∑–≤–æ–ª—è—î –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ —Ä—É—á–∫–∏ —Ä–µ—Å–∞–π–∑—É */
        }
        .window-active { z-index: 500 !important; border-color: var(--accent); }
        
        .window-header {
            height: 42px; background: rgba(255,255,255,0.04);
            display: flex; align-items: center; padding: 0 16px; cursor: move;
            justify-content: space-between; border-bottom: 1px solid var(--glass-border);
            flex-shrink: 0;
            border-radius: 16px 16px 0 0;
        }

        .control-btn { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; }
        .btn-close { background: #ff5f56; }

        /* Resize Handles */
        .resizer {
            position: absolute;
            background: transparent;
        }
        .resizer-r { cursor: e-resize; width: 8px; right: -4px; top: 0; bottom: 0; }
        .resizer-b { cursor: s-resize; height: 8px; bottom: -4px; left: 0; right: 0; }
        .resizer-rb { cursor: se-resize; width: 12px; height: 12px; right: -4px; bottom: -4px; z-index: 10; }

        #context-menu {
            position: fixed; display: none; background: #1a1a2e; border: 1px solid var(--glass-border);
            border-radius: 8px; padding: 5px; z-index: 2000; box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            min-width: 150px;
        }
        .menu-item {
            padding: 8px 12px; font-size: 12px; cursor: pointer; border-radius: 4px;
            display: flex; align-items: center; gap: 8px;
        }
        .menu-item:hover { background: var(--accent); }
        .menu-item.danger:hover { background: var(--danger); }

        .taskbar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(15, 15, 25, 0.8); backdrop-filter: blur(30px);
            padding: 10px 20px; border-radius: 24px; border: 1px solid var(--glass-border);
            display: flex; gap: 15px; z-index: 1000; align-items: center;
        }

        .dock-item {
            width: 46px; height: 46px; border-radius: 12px; display: flex; 
            align-items: center; justify-content: center; font-size: 24px;
            cursor: pointer; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: rgba(255,255,255,0.03);
        }
        .dock-item:hover { transform: scale(1.2) translateY(-10px); background: var(--accent); }

        .loading-spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            width: 24px; height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #icon-preview {
            width: 80px; height: 80px; border-radius: 16px; background: rgba(0,0,0,0.3);
            border: 1px dashed var(--glass-border); display: flex; align-items: center; justify-content: center;
            overflow: hidden; margin-top: 10px; flex-shrink: 0;
        }
        #icon-preview img { width: 100%; height: 100%; object-fit: cover; }
        
        iframe { pointer-events: auto; }
        .window-resizing iframe { pointer-events: none; } /* –©–æ–± iframe –Ω–µ –ø–µ—Ä–µ—Ö–æ–ø–ª—é–≤–∞–≤ –ø–æ–¥—ñ—ó –º–∏—à—ñ –ø—Ä–∏ —Ä–µ—Å–∞–π–∑—ñ */
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="desktop">
        <div class="shortcut" onclick="openWin('factory')">
            <div class="shortcut-icon" style="color: var(--success); border-color: var(--success);">üõ†Ô∏è</div>
            <div class="shortcut-label">App Factory</div>
        </div>
        <div class="shortcut" onclick="openWin('terminal')">
            <div class="shortcut-icon">üíª</div>
            <div class="shortcut-label">Terminal</div>
        </div>
    </div>

    <div id="context-menu">
        <div class="menu-item danger" onclick="deleteTargetApp()">
            <span>üóëÔ∏è</span> –í–∏–¥–∞–ª–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫
        </div>
    </div>

    <!-- Window: Factory -->
    <div class="window" id="win-factory" style="width: 500px; height: 600px; top: 50px; left: 100px;" onmousedown="focusWin('factory')">
        <div class="window-header">
            <span class="brand text-[10px] opacity-70">App Factory PRO</span>
            <div class="control-btn btn-close" onclick="closeWin('factory')"></div>
        </div>
        <div class="p-6 flex flex-col h-full bg-black/40 overflow-y-auto">
            <h2 class="text-2xl font-bold text-emerald-400 mb-6">–°—Ç–≤–æ—Ä–∏—Ç–∏ –î–æ–¥–∞—Ç–æ–∫</h2>
            
            <div class="space-y-5">
                <div>
                    <label class="text-[10px] uppercase font-bold opacity-50 mb-2 block">–ù–∞–∑–≤–∞</label>
                    <input type="text" id="app-name" placeholder="–ù–∞–ø—Ä: Music Player" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 outline-none focus:border-emerald-500 transition">
                </div>
                
                <div>
                    <label class="text-[10px] uppercase font-bold opacity-50 mb-2 block">–û–ø–∏—Å (–§—É–Ω–∫—Ü—ñ—ó)</label>
                    <textarea id="app-desc" placeholder="–©–æ –º–∞—î —Ä–æ–±–∏—Ç–∏ –≤–∞—à –¥–æ–¥–∞—Ç–æ–∫?" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 outline-none focus:border-emerald-500 transition h-20 resize-none"></textarea>
                </div>

                <div class="p-4 bg-white/5 rounded-2xl border border-white/5">
                    <label class="text-[10px] uppercase font-bold opacity-50 mb-3 block">–î–∏–∑–∞–π–Ω —ñ–∫–æ–Ω–∫–∏</label>
                    <div class="flex items-start gap-4">
                        <div id="icon-preview">
                            <span class="text-[10px] opacity-20">NO ICON</span>
                        </div>
                        <div class="flex-grow pt-2">
                            <button id="gen-icon-btn" onclick="generateAppIcon()" class="w-full bg-indigo-600 hover:bg-indigo-500 py-2 rounded-lg text-xs font-bold transition flex items-center justify-center gap-2">
                                <span>üé® –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —ñ–∫–æ–Ω–∫—É</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-auto pt-6">
                <button id="build-btn" onclick="buildApp()" class="w-full bg-emerald-600 hover:bg-emerald-500 py-4 rounded-xl font-bold uppercase tracking-widest transition-all">–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ ‚ú®</button>
                <div id="build-status" class="mt-2 text-[10px] font-mono text-emerald-400 text-center italic h-4"></div>
            </div>
        </div>
    </div>

    <!-- Window: Terminal -->
    <div class="window" id="win-terminal" style="width: 600px; height: 400px; top: 200px; left: 400px;" onmousedown="focusWin('terminal')">
        <div class="window-header">
            <span class="brand text-[10px] opacity-70">System Console</span>
            <div class="control-btn btn-close" onclick="closeWin('terminal')"></div>
        </div>
        <div id="term-body" class="p-4 flex-grow bg-black/90 font-mono text-[11px] text-emerald-500 overflow-y-auto space-y-1">
            <div>> AI OS initialized...</div>
            <div>> Kernel: 4.8.5-STABLE</div>
            <div>> Resizable Core: ENABLED</div>
        </div>
    </div>

    <div class="taskbar">
        <div class="dock-item" onclick="openWin('factory')">üõ†Ô∏è</div>
        <div class="dock-item" onclick="openWin('terminal')">üíª</div>
        <div id="clock" class="ml-4 text-[10px] font-mono opacity-50">00:00</div>
    </div>

    <script>
        const apiKey = ""; 
        let currentIconBase64 = null;
        let contextTargetAppId = null;
        let zStack = 100;

        // --- Core Utility: API Fetch ---
        async function apiRequest(url, body, retries = 5) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                    if (response.ok) return await response.json();
                } catch (e) {}
                await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
            }
            return null;
        }

        async function generateAppIcon() {
            const name = document.getElementById('app-name').value.trim();
            if (!name) return logToTerminal("Error: –ù–∞–∑–≤–∞ –æ–±–æ–≤'—è–∑–∫–æ–≤–∞.", "text-red-400");
            
            const btn = document.getElementById('gen-icon-btn');
            const preview = document.getElementById('icon-preview');
            btn.disabled = true;
            btn.innerHTML = `<div class="loading-spinner"></div>`;
            
            const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;
            const result = await apiRequest(url, {
                instances: { prompt: `Modern 3D app icon for "${name}", glass style, professional.` },
                parameters: { sampleCount: 1 }
            });

            if (result?.predictions?.[0]) {
                currentIconBase64 = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                preview.innerHTML = `<img src="${currentIconBase64}" class="w-full h-full object-cover">`;
                logToTerminal(`System: –Ü–∫–æ–Ω–∫—É —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è "${name}"`);
            }
            btn.disabled = false;
            btn.innerHTML = `<span>üé® –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —ñ–∫–æ–Ω–∫—É</span>`;
        }

        async function buildApp() {
            const name = document.getElementById('app-name').value.trim();
            const desc = document.getElementById('app-desc').value.trim();
            if (!name || !desc) return;

            const btn = document.getElementById('build-btn');
            const status = document.getElementById('build-status');
            btn.disabled = true;
            status.innerText = "SYNTHESIZING...";

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const result = await apiRequest(url, {
                contents: [{ parts: [{ text: `Single-file HTML app. Name: ${name}. Concept: ${desc}. Use Tailwind.` }] }]
            });

            const code = result?.candidates?.[0]?.content?.parts?.[0]?.text;
            if (code) {
                installApp(name, code.replace(/```html|```/g, "").trim(), currentIconBase64);
                status.innerText = "DEPLOYED!";
            }
            setTimeout(() => { btn.disabled = false; status.innerText = ""; }, 2000);
        }

        function installApp(name, code, iconData) {
            const id = 'app_' + Date.now();
            const shortcut = document.createElement('div');
            shortcut.className = 'shortcut';
            shortcut.dataset.appId = id;
            shortcut.innerHTML = `<div class="shortcut-icon">${iconData ? `<img src="${iconData}">` : `üì¶`}</div><div class="shortcut-label">${name}</div>`;
            shortcut.onclick = () => openWin(id);
            shortcut.oncontextmenu = (e) => { e.preventDefault(); showContextMenu(e.clientX, e.clientY, id); };
            document.getElementById('desktop').appendChild(shortcut);

            const win = document.createElement('div');
            win.id = 'win-' + id;
            win.className = 'window';
            win.style.cssText = `width:600px; height:400px; top:100px; left:100px;`;
            win.onmousedown = () => focusWin(id);
            win.innerHTML = `
                <div class="window-header">
                    <span class="brand text-[10px] uppercase">${name}</span>
                    <div class="control-btn btn-close" onclick="closeWin('${id}')"></div>
                </div>
                <div class="flex-grow bg-[#05050a] relative overflow-hidden">
                    <iframe id="frame-${id}" class="w-full h-full border-none"></iframe>
                </div>
            `;
            document.body.appendChild(win);
            const iframe = document.getElementById('frame-' + id).contentWindow.document;
            iframe.open(); iframe.write(code); iframe.close();
            
            initWin(win);
            openWin(id);
        }

        // --- Window Management (Drag & Resize) ---
        function initWin(win) {
            const header = win.querySelector('.window-header');
            
            // Dragging
            header.onmousedown = (e) => {
                if (e.target.classList.contains('control-btn')) return;
                focusWin(win.id);
                const ox = e.clientX - win.offsetLeft;
                const oy = e.clientY - win.offsetTop;
                
                document.onmousemove = (ev) => {
                    win.style.left = ev.clientX - ox + 'px';
                    win.style.top = ev.clientY - oy + 'px';
                };
                document.onmouseup = () => document.onmousemove = null;
            };

            // Create Resizers
            const resizers = [
                { cls: 'resizer-r', axis: 'x' },
                { cls: 'resizer-b', axis: 'y' },
                { cls: 'resizer-rb', axis: 'both' }
            ];

            resizers.forEach(r => {
                const handle = document.createElement('div');
                handle.className = `resizer ${r.cls}`;
                win.appendChild(handle);

                handle.onmousedown = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    focusWin(win.id);
                    win.classList.add('window-resizing');

                    const startW = win.offsetWidth;
                    const startH = win.offsetHeight;
                    const startX = e.clientX;
                    const startY = e.clientY;

                    document.onmousemove = (ev) => {
                        if (r.axis === 'x' || r.axis === 'both') {
                            win.style.width = Math.max(300, startW + (ev.clientX - startX)) + 'px';
                        }
                        if (r.axis === 'y' || r.axis === 'both') {
                            win.style.height = Math.max(200, startH + (ev.clientY - startY)) + 'px';
                        }
                    };

                    document.onmouseup = () => {
                        win.classList.remove('window-resizing');
                        document.onmousemove = null;
                    };
                };
            });
        }

        function focusWin(id) {
            zStack++;
            const win = id.startsWith('win-') ? document.getElementById(id) : document.getElementById('win-' + id);
            if (win) {
                document.querySelectorAll('.window').forEach(w => w.classList.remove('window-active'));
                win.style.zIndex = zStack;
                win.classList.add('window-active');
            }
        }

        function openWin(id) {
            const win = document.getElementById('win-' + id);
            if (win) { win.style.display = 'flex'; focusWin(id); }
        }

        function closeWin(id) {
            document.getElementById('win-' + id).style.display = 'none';
        }

        function showContextMenu(x, y, id) {
            const menu = document.getElementById('context-menu');
            contextTargetAppId = id;
            menu.style.left = x + 'px'; menu.style.top = y + 'px'; menu.style.display = 'block';
        }

        function deleteTargetApp() {
            document.querySelector(`.shortcut[data-app-id="${contextTargetAppId}"]`)?.remove();
            document.getElementById('win-' + contextTargetAppId)?.remove();
        }

        function logToTerminal(msg, color = "text-emerald-500") {
            const body = document.getElementById('term-body');
            const entry = document.createElement('div');
            entry.className = color;
            entry.innerText = `> ${msg}`;
            body.appendChild(entry);
            body.scrollTop = body.scrollHeight;
        }

        document.addEventListener('click', () => document.getElementById('context-menu').style.display = 'none');

        window.onload = () => {
            document.querySelectorAll('.window').forEach(initWin);
            setInterval(() => {
                document.getElementById('clock').innerText = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }, 1000);
        };
    </script>
</body>
</html>
